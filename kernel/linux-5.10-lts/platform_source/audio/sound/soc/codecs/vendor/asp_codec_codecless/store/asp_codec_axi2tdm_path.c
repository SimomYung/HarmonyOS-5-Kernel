/*
 * asp_codec_axi2tdm_path.c -- codec driver.
 *
 * Copyright (c) 2022 Huawei Technologies Co., Ltd.
 *
 * This software is licensed under the terms of the GNU General Public
 * License version 2, as published by the Free Software Foundation, and
 * may be copied, distributed, and modified under those terms.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 */

#include <sound/soc.h>
#include <linux/delay.h>

#include "audio_log.h"
#include "asp_codec_type.h"
#include "asp_codec_store.h"
#include "audio_pinctrl.h"

#define LOG_TAG "asp_codec_axi2tdm_path"

#define INTIF1_KCONTROLS \
	SOC_SINGLE("INTF1_I2S_TDM_MODE", \
		AXI2TDM_INTF1_CLK_CTRL0_REG, AXI2TDM_INTF1_I2S_TDM_MODE_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_I2S_TDM_MODE_LEN), 0), \
	SOC_SINGLE("INTF1_MST_SLV", \
		AXI2TDM_INTF1_CLK_CTRL0_REG, AXI2TDM_INTF1_MST_SLV_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_MST_SLV_LEN), 0), \
	SOC_SINGLE("INTF1_TDM_FS", \
		AXI2TDM_INTF1_CLK_CTRL0_REG, AXI2TDM_INTF1_TDM_FS_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM_FS_LEN), 0), \
	SOC_SINGLE("INTF1_I2S_FS", \
		AXI2TDM_INTF1_CLK_CTRL0_REG, AXI2TDM_INTF1_I2S_FS_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_I2S_FS_LEN), 0), \
	SOC_SINGLE("INTF1_TDM_RX_CLK_SEL", \
		AXI2TDM_INTF1_CLK_CTRL0_REG, AXI2TDM_INTF1_TDM_RX_CLK_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM_RX_CLK_SEL_LEN), 0), \
	SOC_SINGLE("INTF1_TDM_TX_CLK_SEL", \
		AXI2TDM_INTF1_CLK_CTRL0_REG, AXI2TDM_INTF1_TDM_TX_CLK_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM_TX_CLK_SEL_LEN), 0), \
	SOC_SINGLE("INTF1_I2S_RX_CLK_SEL", \
		AXI2TDM_INTF1_CLK_CTRL0_REG, AXI2TDM_INTF1_I2S_RX_CLK_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_I2S_RX_CLK_SEL_LEN), 0), \
	SOC_SINGLE("INTF1_I2S_TX_CLK_SEL", \
		AXI2TDM_INTF1_CLK_CTRL0_REG, AXI2TDM_INTF1_I2S_TX_CLK_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_I2S_TX_CLK_SEL_LEN), 0), \
	SOC_SINGLE("INTF1_TDM256_IF_EN", \
		AXI2TDM_INTF1_CLK_CTRL0_REG, AXI2TDM_INTF1_TDM256_IF_EN_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM256_IF_EN_LEN), 0), \
	SOC_SINGLE("INTF1_TDM128_IF_EN", \
		AXI2TDM_INTF1_CLK_CTRL0_REG, AXI2TDM_INTF1_TDM128_IF_EN_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM128_IF_EN_LEN), 0), \
	SOC_SINGLE("INTF1_I2S_IF_RX_EN", \
		AXI2TDM_INTF1_CLK_CTRL0_REG, AXI2TDM_INTF1_I2S_IF_RX_ENA_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_I2S_IF_RX_ENA_LEN), 0), \
	SOC_SINGLE("INTF1_I2S_IF_TX_EN", \
		AXI2TDM_INTF1_CLK_CTRL0_REG, AXI2TDM_INTF1_I2S_IF_TX_ENA_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_I2S_IF_TX_ENA_LEN), 0), \
	SOC_SINGLE("INTF1_I2S_FUNC_MODE", \
		AXI2TDM_INTF1_I2S_CTRL_REG, AXI2TDM_INTF1_I2S_FUNC_MODE_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_I2S_FUNC_MODE_LEN), 0), \
	SOC_SINGLE("INTF1_I2S_DIRECT_LOOP", \
		AXI2TDM_INTF1_I2S_CTRL_REG, AXI2TDM_INTF1_I2S_DIRECT_LOOP_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_I2S_DIRECT_LOOP_LEN), 0), \
	SOC_SINGLE("INTF1_I2S_SDO_LINE_SEL", \
		AXI2TDM_INTF1_I2S_CTRL_REG, AXI2TDM_INTF1_I2S_SDO_LINE_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_I2S_SDO_LINE_SEL_LEN), 0), \
	SOC_SINGLE("INTF1_I2S_SDI_LINE_SEL", \
		AXI2TDM_INTF1_I2S_CTRL_REG, AXI2TDM_INTF1_I2S_SDI_LINE_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_I2S_SDI_LINE_SEL_LEN), 0), \
	SOC_SINGLE("INTF1_TDM256_RX3_SLOT_SEL", \
		AXI2TDM_INTF1_TDM256_CTRL0_REG, AXI2TDM_INTF1_TDM256_RX3_SLOT_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM256_RX3_SLOT_SEL_LEN), 0), \
	SOC_SINGLE("INTF1_TDM256_RX2_SLOT_SEL", \
		AXI2TDM_INTF1_TDM256_CTRL0_REG, AXI2TDM_INTF1_TDM256_RX2_SLOT_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM256_RX2_SLOT_SEL_LEN), 0), \
	SOC_SINGLE("INTF1_TDM256_RX1_SLOT_SEL", \
		AXI2TDM_INTF1_TDM256_CTRL0_REG, AXI2TDM_INTF1_TDM256_RX1_SLOT_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM256_RX1_SLOT_SEL_LEN), 0), \
	SOC_SINGLE("INTF1_TDM256_RX0_SLOT_SEL", \
		AXI2TDM_INTF1_TDM256_CTRL0_REG, AXI2TDM_INTF1_TDM256_RX0_SLOT_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM256_RX0_SLOT_SEL_LEN), 0), \
	SOC_SINGLE("INTF1_TDM256_DIRECT_LOOP", \
		AXI2TDM_INTF1_TDM256_CTRL0_REG, AXI2TDM_INTF1_TDM256_DIRECT_LOOP_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM256_DIRECT_LOOP_LEN), 0), \
	SOC_SINGLE("INTF1_TDM256_FRAME_MODE", \
		AXI2TDM_INTF1_TDM256_CTRL0_REG, AXI2TDM_INTF1_TDM256_FRAME_MODE_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM256_FRAME_MODE_LEN), 0), \
	SOC_SINGLE("INTF1_TDM128_FRAME_MODE", \
		AXI2TDM_INTF1_TDM128_CTRL0_REG, AXI2TDM_INTF1_TDM128_FRAME_MODE_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM128_FRAME_MODE_LEN), 0), \
	SOC_SINGLE("INTF1_TDM256_SDO_LINE_SEL", \
		AXI2TDM_INTF1_TDM256_CTRL0_REG, AXI2TDM_INTF1_TDM256_SDO_LINE_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM256_SDO_LINE_SEL_LEN), 0), \
	SOC_SINGLE("INTF1_TDM256_SDI_LINE_SEL", \
		AXI2TDM_INTF1_TDM256_CTRL0_REG, AXI2TDM_INTF1_TDM256_SDI_LINE_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF1_TDM256_SDI_LINE_SEL_LEN), 0), \

#define INTIF2_KCONTROLS \
	SOC_SINGLE("INTF2_CLK_BOOST_EN", \
		AXI2TDM_INTF2_CLK_CTRL_REG, AXI2TDM_INTF2_CLK_BOOST_EN_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_CLK_BOOST_EN_LEN), 0), \
	SOC_SINGLE("INTF2_I2S_TDM_MODE", \
		AXI2TDM_INTF2_CLK_CTRL0_REG, AXI2TDM_INTF2_I2S_TDM_MODE_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_I2S_TDM_MODE_LEN), 0), \
	SOC_SINGLE("INTF2_MST_SLV", \
		AXI2TDM_INTF2_CLK_CTRL0_REG, AXI2TDM_INTF2_MST_SLV_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_MST_SLV_LEN), 0), \
	SOC_SINGLE("INTF2_TDM_FS", \
		AXI2TDM_INTF2_CLK_CTRL0_REG, AXI2TDM_INTF2_TDM_FS_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM_FS_LEN), 0), \
	SOC_SINGLE("INTF2_I2S_FS", \
		AXI2TDM_INTF2_CLK_CTRL0_REG, AXI2TDM_INTF2_I2S_FS_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_I2S_FS_LEN), 0), \
	SOC_SINGLE("INTF2_TDM_RX_CLK_SEL", \
		AXI2TDM_INTF2_CLK_CTRL0_REG, AXI2TDM_INTF2_TDM_RX_CLK_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM_RX_CLK_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_TDM_TX_CLK_SEL", \
		AXI2TDM_INTF2_CLK_CTRL0_REG, AXI2TDM_INTF2_TDM_TX_CLK_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM_TX_CLK_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_I2S_RX_CLK_SEL", \
		AXI2TDM_INTF2_CLK_CTRL0_REG, AXI2TDM_INTF2_I2S_RX_CLK_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_I2S_RX_CLK_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_I2S_TX_CLK_SEL", \
		AXI2TDM_INTF2_CLK_CTRL0_REG, AXI2TDM_INTF2_I2S_TX_CLK_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_I2S_TX_CLK_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_TDM256_IF_EN", \
		AXI2TDM_INTF2_CLK_CTRL0_REG, AXI2TDM_INTF2_TDM256_IF_EN_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM256_IF_EN_LEN), 0), \
	SOC_SINGLE("INTF2_TDM128_IF_EN", \
		AXI2TDM_INTF2_CLK_CTRL0_REG, AXI2TDM_INTF2_TDM128_IF_EN_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM128_IF_EN_LEN), 0), \
	SOC_SINGLE("INTF2_I2S_IF_RX_EN", \
		AXI2TDM_INTF2_CLK_CTRL0_REG, AXI2TDM_INTF2_I2S_IF_RX_ENA_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_I2S_IF_RX_ENA_LEN), 0), \
	SOC_SINGLE("INTF2_I2S_IF_TX_EN", \
		AXI2TDM_INTF2_CLK_CTRL0_REG, AXI2TDM_INTF2_I2S_IF_TX_ENA_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_I2S_IF_TX_ENA_LEN), 0), \
	SOC_SINGLE("INTF2_I2S_FUNC_MODE", \
		AXI2TDM_INTF2_I2S_CTRL_REG, AXI2TDM_INTF2_I2S_FUNC_MODE_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_I2S_FUNC_MODE_LEN), 0), \
	SOC_SINGLE("INTF2_I2S_DIRECT_LOOP", \
		AXI2TDM_INTF2_I2S_CTRL_REG, AXI2TDM_INTF2_I2S_DIRECT_LOOP_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_I2S_DIRECT_LOOP_LEN), 0), \
	SOC_SINGLE("INTF2_I2S_SDO_LINE_SEL", \
		AXI2TDM_INTF2_I2S_CTRL_REG, AXI2TDM_INTF2_I2S_SDO_LINE_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_I2S_SDO_LINE_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_I2S_SDI_LINE_SEL", \
		AXI2TDM_INTF2_I2S_CTRL_REG, AXI2TDM_INTF2_I2S_SDI_LINE_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_I2S_SDI_LINE_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_TDM256_RX3_SLOT_SEL", \
		AXI2TDM_INTF2_TDM256_CTRL0_REG, AXI2TDM_INTF2_TDM256_RX3_SLOT_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM256_RX3_SLOT_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_TDM256_RX2_SLOT_SEL", \
		AXI2TDM_INTF2_TDM256_CTRL0_REG, AXI2TDM_INTF2_TDM256_RX2_SLOT_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM256_RX2_SLOT_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_TDM256_RX1_SLOT_SEL", \
		AXI2TDM_INTF2_TDM256_CTRL0_REG, AXI2TDM_INTF2_TDM256_RX1_SLOT_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM256_RX1_SLOT_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_TDM256_RX0_SLOT_SEL", \
		AXI2TDM_INTF2_TDM256_CTRL0_REG, AXI2TDM_INTF2_TDM256_RX0_SLOT_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM256_RX0_SLOT_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_TDM256_DIRECT_LOOP", \
		AXI2TDM_INTF2_TDM256_CTRL0_REG, AXI2TDM_INTF2_TDM256_DIRECT_LOOP_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM256_DIRECT_LOOP_LEN), 0), \
	SOC_SINGLE("INTF2_TDM256_FRAME_MODE", \
		AXI2TDM_INTF2_TDM256_CTRL0_REG, AXI2TDM_INTF2_TDM256_FRAME_MODE_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM256_FRAME_MODE_LEN), 0), \
	SOC_SINGLE("INTF2_TDM256_SDO_LINE_SEL", \
		AXI2TDM_INTF2_TDM256_CTRL0_REG, AXI2TDM_INTF2_TDM256_SDO_LINE_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM256_SDO_LINE_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_TDM256_SDI_LINE_SEL", \
		AXI2TDM_INTF2_TDM256_CTRL0_REG, AXI2TDM_INTF2_TDM256_SDI_LINE_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_TDM256_SDI_LINE_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_PCM16_SLV_CLK_SEL", \
		AXI2TDM_INTF2_CLK_CTRL1_REG, AXI2TDM_INTF2_PCM16_CLK_IN_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_PCM16_CLK_IN_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_PCM32_SLV_CLK_SEL", \
		AXI2TDM_INTF2_CLK_CTRL1_REG, AXI2TDM_INTF2_PCM32_CLK_IN_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_PCM32_CLK_IN_SEL_LEN), 0), \
	SOC_SINGLE("INTF2_I2S_IO_WORDLENGTH", \
		AXI2TDM_INTF2_I2S_CTRL_REG, AXI2TDM_INTF2_I2S_CODEC_IO_WORDLENGTH_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_I2S_CODEC_IO_WORDLENGTH_LEN), 0), \
	SOC_SINGLE("INTF2_I2S_FRAME_MODE", \
		AXI2TDM_INTF2_I2S_CTRL_REG, AXI2TDM_INTF2_I2S_FRAME_MODE_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF2_I2S_FRAME_MODE_LEN), 0), \

#define INTIF3_KCONTROLS \
	SOC_SINGLE("INTF3_CLK_BOOST_EN", \
		AXI2TDM_INTF3_CLK_CTRL_REG, AXI2TDM_INTF3_CLK_BOOST_EN_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_CLK_BOOST_EN_LEN), 0), \
	SOC_SINGLE("INTF3_I2S_TDM_MODE", \
		AXI2TDM_INTF3_CLK_CTRL0_REG, AXI2TDM_INTF3_I2S_TDM_MODE_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_I2S_TDM_MODE_LEN), 0), \
	SOC_SINGLE("INTF3_MST_SLV", \
		AXI2TDM_INTF3_CLK_CTRL0_REG, AXI2TDM_INTF3_MST_SLV_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_MST_SLV_LEN), 0), \
	SOC_SINGLE("INTF3_TDM_FS", \
		AXI2TDM_INTF3_CLK_CTRL0_REG, AXI2TDM_INTF3_TDM_FS_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM_FS_LEN), 0), \
	SOC_SINGLE("INTF3_I2S_FS", \
		AXI2TDM_INTF3_CLK_CTRL0_REG, AXI2TDM_INTF3_I2S_FS_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_I2S_FS_LEN), 0), \
	SOC_SINGLE("INTF3_TDM_RX_CLK_SEL", \
		AXI2TDM_INTF3_CLK_CTRL0_REG, AXI2TDM_INTF3_TDM_RX_CLK_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM_RX_CLK_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_TDM_TX_CLK_SEL", \
		AXI2TDM_INTF3_CLK_CTRL0_REG, AXI2TDM_INTF3_TDM_TX_CLK_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM_TX_CLK_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_I2S_RX_CLK_SEL", \
		AXI2TDM_INTF3_CLK_CTRL0_REG, AXI2TDM_INTF3_I2S_RX_CLK_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_I2S_RX_CLK_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_I2S_TX_CLK_SEL", \
		AXI2TDM_INTF3_CLK_CTRL0_REG, AXI2TDM_INTF3_I2S_TX_CLK_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_I2S_TX_CLK_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_TDM256_IF_EN", \
		AXI2TDM_INTF3_CLK_CTRL0_REG, AXI2TDM_INTF3_TDM256_IF_EN_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM256_IF_EN_LEN), 0), \
	SOC_SINGLE("INTF3_TDM128_IF_EN", \
		AXI2TDM_INTF3_CLK_CTRL0_REG, AXI2TDM_INTF3_TDM128_IF_EN_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM128_IF_EN_LEN), 0), \
	SOC_SINGLE("INTF3_I2S_IF_RX_EN", \
		AXI2TDM_INTF3_CLK_CTRL0_REG, AXI2TDM_INTF3_I2S_IF_RX_ENA_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_I2S_IF_RX_ENA_LEN), 0), \
	SOC_SINGLE("INTF3_I2S_IF_TX_EN", \
		AXI2TDM_INTF3_CLK_CTRL0_REG, AXI2TDM_INTF3_I2S_IF_TX_ENA_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_I2S_IF_TX_ENA_LEN), 0), \
	SOC_SINGLE("INTF3_I2S_FUNC_MODE", \
		AXI2TDM_INTF3_I2S_CTRL_REG, AXI2TDM_INTF3_I2S_FUNC_MODE_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_I2S_FUNC_MODE_LEN), 0), \
	SOC_SINGLE("INTF3_I2S_DIRECT_LOOP", \
		AXI2TDM_INTF3_I2S_CTRL_REG, AXI2TDM_INTF3_I2S_DIRECT_LOOP_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_I2S_DIRECT_LOOP_LEN), 0), \
	SOC_SINGLE("INTF3_I2S_SDO_LINE_SEL", \
		AXI2TDM_INTF3_I2S_CTRL_REG, AXI2TDM_INTF3_I2S_SDO_LINE_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_I2S_SDO_LINE_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_I2S_SDI_LINE_SEL", \
		AXI2TDM_INTF3_I2S_CTRL_REG, AXI2TDM_INTF3_I2S_SDI_LINE_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_I2S_SDI_LINE_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_TDM256_RX3_SLOT_SEL", \
		AXI2TDM_INTF3_TDM256_CTRL0_REG, AXI2TDM_INTF3_TDM256_RX3_SLOT_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM256_RX3_SLOT_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_TDM256_RX2_SLOT_SEL", \
		AXI2TDM_INTF3_TDM256_CTRL0_REG, AXI2TDM_INTF3_TDM256_RX2_SLOT_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM256_RX2_SLOT_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_TDM256_RX1_SLOT_SEL", \
		AXI2TDM_INTF3_TDM256_CTRL0_REG, AXI2TDM_INTF3_TDM256_RX1_SLOT_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM256_RX1_SLOT_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_TDM256_RX0_SLOT_SEL", \
		AXI2TDM_INTF3_TDM256_CTRL0_REG, AXI2TDM_INTF3_TDM256_RX0_SLOT_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM256_RX0_SLOT_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_TDM256_DIRECT_LOOP", \
		AXI2TDM_INTF3_TDM256_CTRL0_REG, AXI2TDM_INTF3_TDM256_DIRECT_LOOP_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM256_DIRECT_LOOP_LEN), 0), \
	SOC_SINGLE("INTF3_TDM256_FRAME_MODE", \
		AXI2TDM_INTF3_TDM256_CTRL0_REG, AXI2TDM_INTF3_TDM256_FRAME_MODE_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM256_FRAME_MODE_LEN), 0), \
	SOC_SINGLE("INTF3_TDM256_SDO_LINE_SEL", \
		AXI2TDM_INTF3_TDM256_CTRL0_REG, AXI2TDM_INTF3_TDM256_SDO_LINE_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM256_SDO_LINE_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_TDM256_SDI_LINE_SEL", \
		AXI2TDM_INTF3_TDM256_CTRL0_REG, AXI2TDM_INTF3_TDM256_SDI_LINE_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_TDM256_SDI_LINE_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_PCM16_SLV_CLK_SEL", \
		AXI2TDM_INTF3_CLK_CTRL1_REG, AXI2TDM_INTF3_PCM16_CLK_IN_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_PCM16_CLK_IN_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_PCM32_SLV_CLK_SEL", \
		AXI2TDM_INTF3_CLK_CTRL1_REG, AXI2TDM_INTF3_PCM32_CLK_IN_SEL_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_PCM32_CLK_IN_SEL_LEN), 0), \
	SOC_SINGLE("INTF3_I2S_IO_WORDLENGTH", \
		AXI2TDM_INTF3_I2S_CTRL_REG, AXI2TDM_INTF3_I2S_CODEC_IO_WORDLENGTH_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_I2S_CODEC_IO_WORDLENGTH_LEN), 0), \
	SOC_SINGLE("INTF3_I2S_FRAME_MODE", \
		AXI2TDM_INTF3_I2S_CTRL_REG, AXI2TDM_INTF3_I2S_FRAME_MODE_OFFSET, \
		max_val_on_bit(AXI2TDM_INTF3_I2S_FRAME_MODE_LEN), 0), \

static const struct snd_kcontrol_new axi2tdm_snd_kcontrols[] = {
	INTIF1_KCONTROLS
	INTIF2_KCONTROLS
	INTIF3_KCONTROLS
};

static int audio_intf1_power_event(struct snd_soc_dapm_widget *w,
	struct snd_kcontrol *kcontrol, int event)
{
	struct snd_soc_component *codec = snd_soc_dapm_to_component(w->dapm);

	IN_FUNCTION;

	switch (event) {
	case SND_SOC_DAPM_PRE_PMU:
		snd_soc_component_update_bits(codec, AXI2TDM_INTF1_CLK_CTRL0_REG,
			BIT(AXI2TDM_INTF1_CORE_CLK_EN_OFFSET) | BIT(AXI2TDM_INTF1_CLK_EN_OFFSET), 0);
		udelay(CLEAR_FIFO_DELAY_LEN_US);
		snd_soc_component_update_bits(codec, AXI2TDM_CLK_CTRL_REG,
			BIT(AXI2TDM_CODEC_DP1_UP_CLK_EN_OFFSET) | BIT(AXI2TDM_CODEC_DP1_DN_CLK_EN_OFFSET) |
			BIT(AXI2TDM_CODEC_DP_EN_OFFSET),
			BIT(AXI2TDM_CODEC_DP1_UP_CLK_EN_OFFSET) | BIT(AXI2TDM_CODEC_DP1_DN_CLK_EN_OFFSET) |
			BIT(AXI2TDM_CODEC_DP_EN_OFFSET));
		/* dma select */
		snd_soc_component_write(codec, R_DMA_SEL, 0x200000);
		snd_soc_component_update_bits(codec, R_CODEC_DMA_SEL,
			BIT(CODEC_DMA_SEL), BIT(CODEC_DMA_SEL));
		snd_soc_component_update_bits(codec, AXI2TDM_INTF1_CLK_CTRL0_REG,
			BIT(AXI2TDM_INTF1_CORE_CLK_EN_OFFSET) | BIT(AXI2TDM_INTF1_CLK_EN_OFFSET),
			BIT(AXI2TDM_INTF1_CORE_CLK_EN_OFFSET) | BIT(AXI2TDM_INTF1_CLK_EN_OFFSET));
		break;
	case SND_SOC_DAPM_POST_PMD:
		snd_soc_component_update_bits(codec, AXI2TDM_INTF1_CLK_CTRL0_REG,
			BIT(AXI2TDM_INTF1_CORE_CLK_EN_OFFSET) | BIT(AXI2TDM_INTF1_CLK_EN_OFFSET), 0);
		snd_soc_component_write(codec, R_DMA_SEL, 0x200020);
		snd_soc_component_update_bits(codec, R_CODEC_DMA_SEL, BIT(CODEC_DMA_SEL), 0);
		snd_soc_component_update_bits(codec, AXI2TDM_CLK_CTRL_REG,
			BIT(AXI2TDM_CODEC_DP1_UP_CLK_EN_OFFSET) | BIT(AXI2TDM_CODEC_DP1_DN_CLK_EN_OFFSET) |
			BIT(AXI2TDM_CODEC_DP_EN_OFFSET), 0);
		break;
	default:
		AUDIO_LOGW("power event err: %d", event);
		break;
	}

	OUT_FUNCTION;
	return 0;
}

static int audio_intf2_power_event(struct snd_soc_dapm_widget *w,
	struct snd_kcontrol *kcontrol, int event)
{
	struct snd_soc_component *codec = snd_soc_dapm_to_component(w->dapm);

	IN_FUNCTION;

	switch (event) {
	case SND_SOC_DAPM_PRE_PMU:
		snd_soc_component_update_bits(codec, AXI2TDM_INTF2_CLK_CTRL_REG,
			BIT(AXI2TDM_INTF2_CORE_CLK_EN_OFFSET), 0);
		snd_soc_component_update_bits(codec, AXI2TDM_INTF2_CLK_CTRL0_REG,
			BIT(AXI2TDM_INTF2_CLK_EN_OFFSET), 0);
		udelay(CLEAR_FIFO_DELAY_LEN_US);
		snd_soc_component_update_bits(codec, AXI2TDM_CLK_CTRL_REG2,
			BIT(AXI2TDM_CODEC_DP2_UP_CLK_EN_OFFSET) | BIT(AXI2TDM_CODEC_DP2_DN_CLK_EN_OFFSET) |
			BIT(AXI2TDM_CODEC_DP_EN_OFFSET),
			BIT(AXI2TDM_CODEC_DP2_UP_CLK_EN_OFFSET) | BIT(AXI2TDM_CODEC_DP2_DN_CLK_EN_OFFSET) |
			BIT(AXI2TDM_CODEC_DP_EN_OFFSET));
		snd_soc_component_update_bits(codec, AXI2TDM_INTF2_CLK_CTRL_REG,
			BIT(AXI2TDM_INTF2_CORE_CLK_EN_OFFSET), BIT(AXI2TDM_INTF2_CORE_CLK_EN_OFFSET));
		snd_soc_component_update_bits(codec, AXI2TDM_INTF2_CLK_CTRL0_REG,
			BIT(AXI2TDM_INTF2_CLK_EN_OFFSET), BIT(AXI2TDM_INTF2_CLK_EN_OFFSET));
		break;
	case SND_SOC_DAPM_POST_PMD:
		snd_soc_component_update_bits(codec, AXI2TDM_INTF2_CLK_CTRL0_REG,
			BIT(AXI2TDM_INTF2_CLK_EN_OFFSET), 0);
		snd_soc_component_update_bits(codec, AXI2TDM_INTF2_CLK_CTRL_REG,
			BIT(AXI2TDM_INTF2_CORE_CLK_EN_OFFSET), 0);
		snd_soc_component_update_bits(codec, AXI2TDM_CLK_CTRL_REG2,
			BIT(AXI2TDM_CODEC_DP2_UP_CLK_EN_OFFSET) | BIT(AXI2TDM_CODEC_DP2_DN_CLK_EN_OFFSET) |
			BIT(AXI2TDM_CODEC_DP_EN_OFFSET), 0);
		break;
	default:
		AUDIO_LOGW("power event err: %d", event);
		break;
	}

	OUT_FUNCTION;
	return 0;
}

static int audio_intf3_power_event(struct snd_soc_dapm_widget *w,
	struct snd_kcontrol *kcontrol, int event)
{
	struct snd_soc_component *codec = snd_soc_dapm_to_component(w->dapm);

	IN_FUNCTION;

	switch (event) {
	case SND_SOC_DAPM_PRE_PMU:
		snd_soc_component_update_bits(codec, AXI2TDM_INTF3_CLK_CTRL_REG,
			BIT(AXI2TDM_INTF3_CORE_CLK_EN_OFFSET), 0);
		snd_soc_component_update_bits(codec, AXI2TDM_INTF3_CLK_CTRL0_REG,
			BIT(AXI2TDM_INTF3_CLK_EN_OFFSET), 0);
		udelay(CLEAR_FIFO_DELAY_LEN_US);
		snd_soc_component_update_bits(codec, AXI2TDM_CLK_CTRL_REG3,
			BIT(AXI2TDM_CODEC_DP3_UP_CLK_EN_OFFSET) | BIT(AXI2TDM_CODEC_DP3_DN_CLK_EN_OFFSET) |
			BIT(AXI2TDM_CODEC_DP_EN_OFFSET),
			BIT(AXI2TDM_CODEC_DP3_UP_CLK_EN_OFFSET) | BIT(AXI2TDM_CODEC_DP3_DN_CLK_EN_OFFSET) |
			BIT(AXI2TDM_CODEC_DP_EN_OFFSET));
		snd_soc_component_update_bits(codec, AXI2TDM_INTF3_CLK_CTRL_REG,
			BIT(AXI2TDM_INTF3_CORE_CLK_EN_OFFSET), BIT(AXI2TDM_INTF3_CORE_CLK_EN_OFFSET));
		snd_soc_component_update_bits(codec, AXI2TDM_INTF3_CLK_CTRL0_REG,
			BIT(AXI2TDM_INTF3_CLK_EN_OFFSET), BIT(AXI2TDM_INTF3_CLK_EN_OFFSET));
		audio_pinctrl_set_pinctrl_mode(AUDIO_PINCTRL_I2S4, AUDIO_PINCTRL_DEFAULT);
		break;
	case SND_SOC_DAPM_POST_PMD:
		audio_pinctrl_set_pinctrl_mode(AUDIO_PINCTRL_I2S4, AUDIO_PINCTRL_IDLE);
		snd_soc_component_update_bits(codec, AXI2TDM_INTF3_CLK_CTRL0_REG,
			BIT(AXI2TDM_INTF3_CLK_EN_OFFSET), 0);
		snd_soc_component_update_bits(codec, AXI2TDM_INTF3_CLK_CTRL_REG,
			BIT(AXI2TDM_INTF3_CORE_CLK_EN_OFFSET), 0);
		snd_soc_component_update_bits(codec, AXI2TDM_CLK_CTRL_REG3,
			BIT(AXI2TDM_CODEC_DP3_UP_CLK_EN_OFFSET) | BIT(AXI2TDM_CODEC_DP3_DN_CLK_EN_OFFSET) |
			BIT(AXI2TDM_CODEC_DP_EN_OFFSET), 0);
		break;
	default:
		AUDIO_LOGW("power event err: %d", event);
		break;
	}

	OUT_FUNCTION;
	return 0;
}

#define AXI2TDM_INPUT_OUTPUT_WIDGET \
	SND_SOC_DAPM_INPUT("INTF1_INPUT"), \
	SND_SOC_DAPM_INPUT("INTF2_INPUT"), \
	SND_SOC_DAPM_INPUT("INTF3_INPUT"), \
	SND_SOC_DAPM_OUTPUT("INTF1_OUTPUT"), \
	SND_SOC_DAPM_OUTPUT("INTF2_OUTPUT"), \
	SND_SOC_DAPM_OUTPUT("INTF3_OUTPUT"), \

static const struct snd_kcontrol_new dapm_audio_intf1_switch_controls =
	SOC_DAPM_SINGLE("ENABLE", CODEC_VIR2_REG_ADDR, AUDIO_AXI2TDM_INTF1_BIT, 1, 0);
static const struct snd_kcontrol_new dapm_audio_intf2_switch_controls =
	SOC_DAPM_SINGLE("ENABLE", CODEC_VIR2_REG_ADDR, AUDIO_AXI2TDM_INTF2_BIT, 1, 0);
static const struct snd_kcontrol_new dapm_audio_intf3_switch_controls =
	SOC_DAPM_SINGLE("ENABLE", CODEC_VIR2_REG_ADDR, AUDIO_AXI2TDM_INTF3_BIT, 1, 0);

#define AXI2TDM_SWITCH_WIDGET \
	SND_SOC_DAPM_SWITCH_E("AUDIO_INTF1_SWITCH", SND_SOC_NOPM, 0, 0, \
		&dapm_audio_intf1_switch_controls, audio_intf1_power_event, \
		(SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD)), \
	SND_SOC_DAPM_SWITCH_E("AUDIO_INTF2_SWITCH", SND_SOC_NOPM, 0, 0, \
		&dapm_audio_intf2_switch_controls, audio_intf2_power_event, \
		(SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD)), \
	SND_SOC_DAPM_SWITCH_E("AUDIO_INTF3_SWITCH", SND_SOC_NOPM, 0, 0, \
		&dapm_audio_intf3_switch_controls, audio_intf3_power_event, \
		(SND_SOC_DAPM_PRE_PMU | SND_SOC_DAPM_POST_PMD)), \

static const struct snd_soc_dapm_widget axi2tm_dapm_widgets[] = {
	AXI2TDM_INPUT_OUTPUT_WIDGET
	AXI2TDM_SWITCH_WIDGET
};

static const struct snd_codec_resource axi2tdm_path_resource = {
	"ASP_CODEC_AXI2TDM",
	axi2tdm_snd_kcontrols,
	ARRAY_SIZE(axi2tdm_snd_kcontrols),
	axi2tm_dapm_widgets,
	ARRAY_SIZE(axi2tm_dapm_widgets),
};

int __init add_axi2tdm_path_in_list(void)
{
	return add_codec_base_dapm_list(&axi2tdm_path_resource);
}
device_initcall(add_axi2tdm_path_in_list);
